#include <climits>
#include <algorithm>
using namespace std;

/** * Definition for a binary tree node. * struct TreeNode { * int val; * TreeNode *left; * TreeNode *right; * TreeNode() : val(0), left(nullptr), right(nullptr) {} * TreeNode(int x) : val(x), left(nullptr), right(nullptr) {} * TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) {} * }; */
class isbst {
public:
    bool valid;
    long long maxm;
    long long minm;
};

class Solution {
public:
    bool isValidBST(TreeNode* root) {
        isbst ans = checkbst(root);
        return ans.valid;
    }

private:
    isbst checkbst(TreeNode* root) {
        if (!root) {
            isbst ans;
            ans.valid = true;
            ans.maxm = LLONG_MIN;
            ans.minm = LLONG_MAX;
            return ans;
        }

        isbst left = checkbst(root->left);
        isbst right = checkbst(root->right);

        long long val = (long long)root->val;
        long long maxm = max({left.maxm, val, right.maxm});
        long long minm = min({left.minm, val, right.minm});

        isbst ans;
        ans.valid = (val > left.maxm) && (val < right.minm) && left.valid && right.valid;
        ans.maxm = maxm;
        ans.minm = minm;

        return ans;
    }
};
